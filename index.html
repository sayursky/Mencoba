<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>üèÜ Kuis ABCD - Versi Lengkap</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(to bottom, #e0f7fa, #ffffff);
      margin: 0;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #0d47a1;
    }
    #loginContainer, #quizContainer, #adminContainer, #totalStatsContainer, #infoContainer {
      background: #ffffff;
      border-radius: 20px;
      padding: 25px;
      max-width: 500px;
      margin: 30px auto;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 12px;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      background-color: #2196f3;
      color: white;
      padding: 12px;
      margin: 8px 0;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }
    button:hover {
      background-color: #1976d2;
    }
    #rankingBarWrapper {
      position: relative;
      overflow: hidden;
    }
    #updateBar {
      position: absolute;
      width: 100%;
      top: 0;
      left: 0;
      z-index: 0;
      background: #b2ebf2;
      color: #006064;
      font-size: 14px;
      padding: 5px;
      white-space: nowrap;
      animation: scrollUpdate 25s linear infinite;
    }
    #rankingBar {
      position: relative;
      background: #0d47a1;
      color: white;
      padding: 10px;
      font-weight: bold;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      z-index: 1;
    }
    #rankingText {
      display: inline-block;
      padding-left: 100%;
      animation: scroll 18s linear infinite;
    }
    @keyframes scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
    @keyframes scrollUpdate {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    #clock {
      text-align: center;
      font-size: 18px;
      margin-top: 10px;
      color: #004d40;
    }
    footer {
      text-align: center;
      margin-top: 40px;
      font-size: 14px;
      color: #777;
    }
  </style>
</head>
<body onload="startClock()">

<div id="rankingBarWrapper">
  <div id="updateBar"></div>
  <div id="rankingBar"><div id="rankingText">üèÖ Peringkat Tertinggi akan tampil di sini...</div></div>
</div>
<div id="clock"></div>

<div id="loginContainer">
  <h2>üë©‚Äçüéì Login Pemain</h2>
  <input type="text" id="username" placeholder="üßë‚Äçüíª Masukkan Username" />
  <button onclick="login()">Masuk</button>
</div>

<div id="infoContainer" style="display:none;">
  <h2>üì¢ Kelola Pemberitahuan</h2>
  <textarea id="infoMessage" placeholder="Tulis pesan update..." rows="3"></textarea>
  <button onclick="simpanPemberitahuan()">üíæ Simpan Pemberitahuan</button>
  <button onclick="resetPemberitahuan()">‚ôªÔ∏è Reset Pemberitahuan</button>
</div>

<div id="quizContainer" style="display:none;">
  <h2>üß† Soal Kuis</h2>
  <div id="questionText"></div>
  <div id="options"></div>
</div>

<div id="adminContainer" style="display:none;">
  <h2>üõ†Ô∏è Menu Admin</h2>
  <input type="text" id="newQuestion" placeholder="Tulis soal..." />
  <input type="text" id="optA" placeholder="Pilihan A" />
  <input type="text" id="optB" placeholder="Pilihan B" />
  <input type="text" id="optC" placeholder="Pilihan C" />
  <input type="text" id="optD" placeholder="Pilihan D" />
  <select id="correctAnswer">
    <option value="">‚úÖ Jawaban Benar</option>
    <option value="A">A</option>
    <option value="B">B</option>
    <option value="C">C</option>
    <option value="D">D</option>
  </select>
  <select id="questionCategory">
    <option value="">üìÇ Pilih Kategori</option>
    <option value="IPA">IPA</option>
    <option value="IPS">IPS</option>
    <option value="Bahasa Indonesia">Bahasa Indonesia</option>
    <option value="Agama">Agama</option>
    <option value="Bahasa Inggris">Bahasa Inggris</option>
    <option value="PJOK">PJOK</option>
    <option value="Mulok">Mulok</option>
    <option value="MTK">MTK</option>
  </select>
  <button onclick="saveQuestion()">üíæ Simpan Soal</button>
</div>

<footer>
  üë®‚Äçüíª Developer: <strong>ABDUL SUKUR</strong>
</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const savedUpdate = localStorage.getItem("updateMessage") || "üîî Versi 2.3 - Total Skor, Jam Real-Time, Developer ABDUL SUKUR ‚ú®";
  document.getElementById("updateBar").innerText = savedUpdate;
});

function startClock() {
  setInterval(() => {
    const now = new Date();
    const timeStr = now.toLocaleTimeString();
    document.getElementById("clock").innerText = `üïí Waktu Sekarang: ${timeStr}`;
  }, 1000);
}

function login() {
  const uname = document.getElementById("username").value.trim();
  if (!uname) return alert("Masukkan username!");

  if (uname.toLowerCase() === "total") return;

  if (uname.toLowerCase() === "info") {
    document.getElementById("loginContainer").style.display = "none";
    document.getElementById("infoContainer").style.display = "block";
    return;
  }

  if (uname === "1234") {
    if (confirm("Reset semua peringkat?")) {
      const categories = ["IPA", "IPS", "Bahasa Indonesia", "Agama", "Bahasa Inggris", "PJOK", "Mulok", "MTK"];
      categories.forEach(cat => localStorage.removeItem(`leaderboard_${cat}`));
      alert("Peringkat berhasil direset!");
    }
    return location.reload();
  }

  localStorage.setItem("currentUser", uname);

  if (uname === "123") {
    document.getElementById("loginContainer").style.display = "none";
    document.getElementById("adminContainer").style.display = "block";
  } else {
    const categories = ["IPA", "IPS", "Bahasa Indonesia", "Agama", "Bahasa Inggris", "PJOK", "Mulok", "MTK"];
    const unansweredQuestions = [];

    categories.forEach(cat => {
      const questions = JSON.parse(localStorage.getItem("questions_" + cat)) || [];
      const answered = JSON.parse(localStorage.getItem(uname + "_answered_" + cat)) || [];
      const remaining = questions.filter(q => !answered.some(a => a.question === q.question));
      if (remaining.length > 0) {
        unansweredQuestions.push({ category: cat, questions: remaining });
      }
    });

    if (unansweredQuestions.length === 0) {
      alert("Tidak ada soal tersedia atau semua soal sudah dijawab. Silakan hubungi admin.");
      return; // tetap di halaman login
    }

    const randomSet = unansweredQuestions[Math.floor(Math.random() * unansweredQuestions.length)];
    document.getElementById("loginContainer").style.display = "none";
    startQuiz(randomSet.category);
  }
}

function startQuiz(category) {
  const uname = localStorage.getItem("currentUser");
  const allQuestions = JSON.parse(localStorage.getItem("questions_" + category)) || [];
  const answered = JSON.parse(localStorage.getItem(uname + "_answered_" + category)) || [];
  const remaining = allQuestions.filter(q => !answered.some(a => a.question === q.question));

  if (remaining.length === 0) {
    alert("Semua soal kategori " + category + " sudah dijawab.");
    location.reload(); // kembali ke login
    return;
  }

  const randomIndex = Math.floor(Math.random() * remaining.length);
  const q = remaining[randomIndex];

  document.getElementById("quizContainer").style.display = "block";
  document.getElementById("questionText").innerHTML = `üìå ${q.question}`;
  const optionsHtml = Object.entries(q.options).map(([key, val]) => {
    return `<button onclick="checkAnswer('${key}', '${q.answer}', ${JSON.stringify(q).replace(/"/g, '&quot;')}, '${category}')">${key}. ${val}</button>`;
  }).join("");
  document.getElementById("options").innerHTML = optionsHtml;
}

function checkAnswer(selected, correct, questionObj, category) {
  const uname = localStorage.getItem("currentUser");
  if (selected === correct) {
    alert("‚úÖ Jawaban Benar!");
  } else {
    alert("‚ùå Jawaban Salah!");
  }

  let answered = JSON.parse(localStorage.getItem(uname + "_answered_" + category)) || [];
  answered.push(questionObj);
  localStorage.setItem(uname + "_answered_" + category, JSON.stringify(answered));

  document.getElementById("quizContainer").style.display = "none";
  location.reload(); // kembali ke login
}

function saveQuestion() {
  const question = document.getElementById("newQuestion").value.trim();
  const A = document.getElementById("optA").value.trim();
  const B = document.getElementById("optB").value.trim();
  const C = document.getElementById("optC").value.trim();
  const D = document.getElementById("optD").value.trim();
  const correct = document.getElementById("correctAnswer").value;
  const category = document.getElementById("questionCategory").value;

  if (!question || !A || !B || !C || !D || !correct || !category) {
    alert("Lengkapi semua kolom terlebih dahulu!");
    return;
  }

  const soalBaru = { question: question, options: { A, B, C, D }, answer: correct };
  let bank = JSON.parse(localStorage.getItem("questions_" + category)) || [];
  bank.push(soalBaru);
  localStorage.setItem("questions_" + category, JSON.stringify(bank));
  alert("Soal berhasil ditambahkan ke kategori " + category + "!");

  document.getElementById("newQuestion").value = "";
  document.getElementById("optA").value = "";
  document.getElementById("optB").value = "";
  document.getElementById("optC").value = "";
  document.getElementById("optD").value = "";
  document.getElementById("correctAnswer").value = "";
  document.getElementById("questionCategory").value = "";
}

function simpanPemberitahuan() {
  const pesan = document.getElementById("infoMessage").value.trim();
  if (!pesan) return alert("Isi pesan tidak boleh kosong!");
  localStorage.setItem("updateMessage", pesan);
  document.getElementById("updateBar").innerText = pesan;
  alert("‚úÖ Pemberitahuan berhasil diperbarui!");
}

function resetPemberitahuan() {
  const defaultMsg = "üîî Versi 2.3 - Total Skor, Jam Real-Time, Developer ABDUL SUKUR ‚ú®";
  localStorage.setItem("updateMessage", defaultMsg);
  document.getElementById("updateBar").innerText = defaultMsg;
  alert("‚ôªÔ∏è Pemberitahuan di-reset ke default.");
}
</script>

</body>
  </html>
